<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-test/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-test";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>第35讲 | JVM优化Java代码时都做了什么？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/java核心技术面试精讲/05.模块四java性能基础/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></span><span>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></li><li>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/java核心技术面试精讲/01.开篇词">01.开篇词</a><ul><li><a href="/blog-test/java核心技术面试精讲/01.开篇词/01"><span>开篇词 | 以面试题为切入点，有效提升你的Java内功</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础">02.模块一Java基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/01"><span>第1讲 | 谈谈你对Java平台的理解？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/02"><span>第2讲 | Exception和Error有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/03"><span>第3讲 | 谈谈final、finally、 finalize有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/04"><span>第4讲 | 强引用、软引用、弱引用、幻象引用有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/05"><span>第5讲 | String、StringBuffer、StringBuilder有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/06"><span>第6讲 | 动态代理是基于什么原理？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/07"><span>第7讲 | int和Integer有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/08"><span>第8讲 | 对比Vector、ArrayList、LinkedList有何区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/09"><span>第9讲 | 对比Hashtable、HashMap、TreeMap有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/10"><span>第10讲 | 如何保证集合是线程安全的? ConcurrentHashMap如何实现高效地线程安全？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/11"><span>第11讲 | Java提供了哪些IO方式？ NIO如何实现多路复用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/12"><span>第12讲 | Java有几种文件拷贝方式？哪一种最高效？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/13"><span>第13讲 | 谈谈接口和抽象类有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/14"><span>第14讲 | 谈谈你知道的设计模式？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶">03.模块二Java进阶</a><ul><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/01"><span>第15讲 | synchronized和ReentrantLock有什么区别呢？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/02"><span>第16讲 | synchronized底层如何实现？什么是锁的升级、降级？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/03"><span>第17讲 | 一个线程两次调用start()方法会出现什么情况？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/04"><span>第18讲 | 什么情况下Java程序会产生死锁？如何定位、修复？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/05"><span>第19讲 | Java并发包提供了哪些并发工具类？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/06"><span>第20讲 | 并发包中的ConcurrentLinkedQueue和LinkedBlockingQueue有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/07"><span>第21讲 | Java并发类库提供的线程池有哪几种？ 分别有什么特点？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/08"><span>第22讲 | AtomicInteger底层实现原理是什么？如何在自己的产品代码中应用CAS操作？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/09"><span>第23讲 | 请介绍类加载过程，什么是双亲委派模型？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/10"><span>第24讲 | 有哪些方法可以在运行时动态生成一个Java类？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11"><span>第25讲 | 谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError?</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12"><span>第26讲 | 如何监控和诊断JVM堆内和堆外内存使用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/13"><span>第27讲 | Java常见的垃圾收集器有哪些？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/14"><span>第28讲 | 谈谈你的GC调优思路?</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/15"><span>第29讲 | Java内存模型中的happen-before是什么？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/16"><span>第30讲 | Java程序运行在Docker等容器环境有哪些新问题？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础">04.模块三Java安全基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/01"><span>第31讲 | 你了解Java应用开发中的注入攻击吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/02"><span>第32讲 | 如何写出安全的Java代码？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础">05.模块四Java性能基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/01"><span>第33讲 | 后台服务出现明显“变慢”，谈谈你的诊断思路？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/02"><span>第34讲 | 有人说“Lambda能让Java程序慢30倍”，你怎么看？</span></a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03"><span>第35讲 | JVM优化Java代码时都做了什么？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展">06.模块5Java应用开发扩展</a><ul><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/01"><span>第36讲 | 谈谈MySQL支持的事务隔离级别，以及悲观锁和乐观锁的原理和应用场景？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/02"><span>第37讲 | 谈谈Spring Bean的生命周期和作用域？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/03"><span>第38讲 | 对比Java标准NIO类库，你知道Netty是如何实现更高性能的吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/04"><span>第39讲 | 谈谈常用的分布式ID的设计方案？Snowflake是否受冬令时切换影响？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利">07.周末福利</a><ul><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/01"><span>周末福利 | 谈谈我对Java学习和面试的看法</span></a></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/02"><span>周末福利 | 一份Java工程师必读书单</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语">08.结束语</a><ul><li><a href="/blog-test/java核心技术面试精讲/08.结束语/01"><span>结束语 | 技术没有终点</span></a></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语/02"><span>结课测试 | Java核心技术的这些知识，你真的掌握了吗？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/summary">java核心技术面试精讲</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="来自JVM专栏作者郑雨迪博士的回答" data-depth="2"><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#来自jvm专栏作者郑雨迪博士的回答"><span>来自JVM专栏作者郑雨迪博士的回答</span></a></li><li title="考点分析" data-depth="2"><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#考点分析"><span>考点分析</span></a></li><li title="知识扩展" data-depth="2"><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#知识扩展"><span>知识扩展</span></a></li><li title="一课一练" data-depth="2"><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#一课一练"><span>一课一练</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="第35讲--jvm优化java代码时都做了什么"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#第35讲--jvm优化java代码时都做了什么"><span class="icon icon-link"></span></a>第35讲 | JVM优化Java代码时都做了什么？</h1><p>我在专栏上一讲介绍了微基准测试和相关的注意事项，其核心就是避免JVM运行中对Java代码的优化导致失真。所以，系统地理解Java代码运行过程，有利于在实践中进行更进一步的调优。</p><p>今天我要问你的问题是，JVM优化Java代码时都做了什么？</p><p>与以往我来给出典型回答的方式不同，今天我邀请了隔壁专栏<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/intro/108?utm_source=app&amp;utm_medium=article&amp;utm_campaign=108-presell&amp;utm_content=java">《深入拆解Java虚拟机》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的作者，同样是来自Oracle的郑雨迪博士，让他以JVM专家的身份去思考并回答这个问题。</p><h2 id="来自jvm专栏作者郑雨迪博士的回答"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#来自jvm专栏作者郑雨迪博士的回答"><span class="icon icon-link"></span></a>来自JVM专栏作者郑雨迪博士的回答</h2><p>JVM在对代码执行的优化可分为运行时（runtime）优化和即时编译器（JIT）优化。运行时优化主要是解释执行和动态编译通用的一些机制，比如说锁机制（如偏斜锁）、内存分配机制（如TLAB）等。除此之外，还有一些专门用于优化解释执行效率的，比如说模版解释器、内联缓存（inline cache，用于优化虚方法调用的动态绑定）。</p><p>JVM的即时编译器优化是指将热点代码以方法为单位转换成机器码，直接运行在底层硬件之上。它采用了多种优化方式，包括静态编译器可以使用的如方法内联、逃逸分析，也包括基于程序运行profile的投机性优化（speculative/optimistic optimization）。这个怎么理解呢？比如我有一条instanceof指令，在编译之前的执行过程中，测试对象的类一直是同一个，那么即时编译器可以假设编译之后的执行过程中还会是这一个类，并且根据这个类直接返回instanceof的结果。如果出现了其他类，那么就抛弃这段编译后的机器码，并且切换回解释执行。</p><p>当然，JVM的优化方式仅仅作用在运行应用代码的时候。如果应用代码本身阻塞了，比如说并发时等待另一线程的结果，这就不在JVM的优化范畴啦。</p><h2 id="考点分析"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#考点分析"><span class="icon icon-link"></span></a>考点分析</h2><p>感谢郑雨迪博士从JVM的角度给出的回答。今天这道面试题在专栏里有不少同学问我，也是会在面试时被面试官刨根问底的一个知识点，郑博士的回答已经非常全面和深入啦。</p><p>大多数Java工程师并不是JVM工程师，知识点总归是要落地的，面试官很有可能会从实践的角度探讨，例如，如何在生产实践中，与JIT等JVM模块进行交互，落实到如何真正进行实际调优。</p><p>在今天这一讲，我会从Java工程师日常的角度出发，侧重于：</p><ul><li><p>从整体去了解Java代码编译、执行的过程，目的是对基本机制和流程有个直观的认识，以保证能够理解调优选择背后的逻辑。</p></li><li><p>从生产系统调优的角度，谈谈将JIT的知识落实到实际工作中的可能思路。这里包括两部分：如何收集JIT相关的信息，以及具体的调优手段。</p></li></ul><h2 id="知识扩展"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#知识扩展"><span class="icon icon-link"></span></a>知识扩展</h2><p>首先，我们从整体的角度来看看Java代码的整个生命周期，你可以参考我提供的示意图。<br/><img src="data:image/png;base64,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" alt=""/></p><p>我在<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/article/6845">专栏第1讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就已经提到过，Java通过引入字节码这种中间表达方式，屏蔽了不同硬件的差异，由JVM负责完成从字节码到机器码的转化。</p><p>通常所说的编译期，是指javac等编译器或者相关API等将源码转换成为字节码的过程，这个阶段也会进行少量类似常量折叠之类的优化，只要利用反编译工具，就可以直接查看细节。</p><p>javac优化与JVM内部优化也存在关联，毕竟它负责了字节码的生成。例如，Java 9中的字符串拼接，会被javac替换成对StringConcatFactory的调用，进而为JVM进行字符串拼接优化提供了统一的入口。在实际场景中，还可以通过不同的<a target="_blank" rel="noopener noreferrer" href="http://openjdk.java.net/jeps/280">策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>选项来干预这个过程。</p><p>今天我要讲的重点是<strong>JVM运行时的优化</strong>，在通常情况下，编译器和解释器是共同起作用的，具体流程可以参考下面的示意图。<br/><img src="/blog-test/static/httpsstatic001geekbangorgresourceimage5c785c095075dcda0f39f0e7395ab9636378.e4b1eefd.png" alt=""/></p><p>JVM会根据统计信息，动态决定什么方法被编译，什么方法解释执行，即使是已经编译过的代码，也可能在不同的运行阶段不再是热点，JVM有必要将这种代码从Code Cache中移除出去，毕竟其大小是有限的。</p><p>就如郑博士所回答的，解释器和编译器也会进行一些通用优化，例如：</p><ul><li><p>锁优化，你可以参考我在<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/article/9042">专栏第16讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供的解释器运行时的源码分析。</p></li><li><p>Intrinsic机制，或者叫作内建方法，就是针对特别重要的基础方法，JDK团队直接提供定制的实现，利用汇编或者编译器的中间表达方式编写，然后JVM会直接在运行时进行替换。</p></li></ul><p>这么做的理由有很多，例如，不同体系结构的CPU在指令等层面存在着差异，定制才能充分发挥出硬件的能力。我们日常使用的典型字符串操作、数组拷贝等基础方法，Hotspot都提供了内建实现。</p><p>而<strong>即时编译器（JIT）</strong>，则是更多优化工作的承担者。JIT对Java编译的基本单元是整个方法，通过对方法调用的计数统计，甄别出热点方法，编译为本地代码。另外一个优化场景，则是最针对所谓热点循环代码，利用通常说的栈上替换技术（OSR，On-Stack Replacement，更加细节请参考<a target="_blank" rel="noopener noreferrer" href="https://github.com/AdoptOpenJDK/jitwatch/wiki/Understanding-the-On-Stack-Replacement-(OSR)-optimisation-in-the-HotSpot-C1-compiler">R大的文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），如果方法本身的调用频度还不够编译标准，但是内部有大的循环之类，则还是会有进一步优化的价值。</p><p>从理论上来看，JIT可以看作就是基于两个计数器实现，方法计数器和回边计数器提供给JVM统计数据，以定位到热点代码。实际中的JIT机制要复杂得多，郑博士提到了<a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Escape_analysis">逃逸分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Loop_unrolling">循环展开<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、方法内联等，包括前面提到的Intrinsic等通用机制同样会在JIT阶段发生。</p><p>第二，有哪些手段可以探查这些优化的具体发生情况呢？</p><p>专栏中已经陆陆续续介绍了一些，我来简单总结一下并补充部分细节。</p><ul><li>打印编译发生的细节。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+PrintCompilation</span></div></pre></div><ul><li>输出更多编译的细节。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:UnlockDiagnosticVMOptions -XX:+LogCompilation -XX:LogFile=&lt;your_file_path&gt;</span></div></pre></div><p>JVM会生成一个xml形式的文件，另外， LogFile选项是可选的，不指定则会输出到</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">hotspot_pid&lt;pid&gt;.log</span></div></pre></div><p>具体格式可以参考Ben Evans提供的<a target="_blank" rel="noopener noreferrer" href="https://github.com/AdoptOpenJDK/jitwatch/">JitWatch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>工具和<a target="_blank" rel="noopener noreferrer" href="http://www.oracle.com/technetwork/articles/java/architect-evans-pt1-2266278.html">分析指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p><img src="/blog-test/static/httpsstatic001geekbangorgresourceimage074607b00499b0ca857fc3ccd51f7046d946.bec0a646.png" alt=""/></p><ul><li>打印内联的发生，可利用下面的诊断选项，也需要明确解锁。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+PrintInlining</span></div></pre></div><ul><li>如何知晓Code Cache的使用状态呢？</li></ul><p>很多工具都已经提供了具体的统计信息，比如，JMC、JConsole之类，我也介绍过使用NMT监控其使用。</p><p>第三，我们作为应用开发者，有哪些可以触手可及的调优角度和手段呢？</p><ul><li>调整热点代码门限值</li></ul><p>我曾经介绍过JIT的默认门限，server模式默认10000次，client是1500次。门限大小也存在着调优的可能，可以使用下面的参数调整；与此同时，该参数还可以变相起到降低预热时间的作用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:CompileThreshold=N</span></div></pre></div><p>很多人可能会产生疑问，既然是热点，不是早晚会达到门限次数吗？这个还真未必，因为JVM会周期性的对计数的数值进行衰减操作，导致调用计数器永远不能达到门限值，除了可以利用CompileThreshold适当调整大小，还有一个办法就是关闭计数器衰减。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:-UseCounterDecay</span></div></pre></div><p>如果你是利用debug版本的JDK，还可以利用下面的参数进行试验，但是生产版本是不支持这个选项的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:CounterHalfLifeTime</span></div></pre></div><ul><li>调整Code Cache大小</li></ul><p>我们知道JIT编译的代码是存储在Code Cache中的，需要注意的是Code Cache是存在大小限制的，而且不会动态调整。这意味着，如果Code Cache太小，可能只有一小部分代码可以被JIT编译，其他的代码则没有选择，只能解释执行。所以，一个潜在的调优点就是调整其大小限制。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:ReservedCodeCacheSize=&lt;SIZE&gt;</span></div></pre></div><p>当然，也可以调整其初始大小。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:InitialCodeCacheSize=&lt;SIZE&gt;</span></div></pre></div><p>注意，在相对较新版本的Java中，由于分层编译（Tiered-Compilation）的存在，Code Cache的空间需求大大增加，其本身默认大小也被提高了。</p><ul><li>调整编译器线程数，或者选择适当的编译器模式</li></ul><p>JVM的编译器线程数目与我们选择的模式有关，选择client模式默认只有一个编译线程，而server模式则默认是两个，如果是当前最普遍的分层编译模式，则会根据CPU内核数目计算C1和C2的数值，你可以通过下面的参数指定的编译线程数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:CICompilerCount=N</span></div></pre></div><p>在强劲的多处理器环境中，增大编译线程数，可能更加充分的利用CPU资源，让预热等过程更加快速；但是，反之也可能导致编译线程争抢过多资源，尤其是当系统非常繁忙时。例如，系统部署了多个Java应用实例的时候，那么减小编译线程数目，则是可以考虑的。</p><p>生产实践中，也有人推荐在服务器上关闭分层编译，直接使用server编译器，虽然会导致稍慢的预热速度，但是可能在特定工作负载上会有微小的吞吐量提高。</p><ul><li>其他一些相对边界比较混淆的所谓“优化”</li></ul><p>比如，减少进入安全点。严格说，它远远不只是发生在动态编译的时候，GC阶段发生的更加频繁，你可以利用下面选项诊断安全点的影响。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+PrintSafepointStatistics ‑XX:+PrintGCApplicationStoppedTime</span></div></pre></div><p>注意，在JDK 9之后，PrintGCApplicationStoppedTime已经被移除了，你需要使用“-Xlog:safepoint”之类方式来指定。</p><p>很多优化阶段都可能和安全点相关，例如：</p><ul><li><p>在JIT过程中，逆优化等场景会需要插入安全点。</p><ul><li>常规的锁优化阶段也可能发生，比如，偏斜锁的设计目的是为了避免无竞争时的同步开销，但是当真的发生竞争时，撤销偏斜锁会触发安全点，是很重的操作。所以，在并发场景中偏斜锁的价值其实是被质疑的，经常会明确建议关闭偏斜锁。</li></ul></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:-UseBiasedLocking</span></div></pre></div><p>主要的优化手段就介绍到这里，这些方法都是普通Java开发者就可以利用的。如果你想对JVM优化手段有更深入的了解，建议你订阅JVM专家郑雨迪博士的专栏。</p><h2 id="一课一练"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03#一课一练"><span class="icon icon-link"></span></a>一课一练</h2><p>关于今天我们讨论的题目你做到心中有数了吗？ 请思考一个问题，如何程序化验证final关键字是否会影响性能？</p><p>请你在留言区写写你对这个问题的思考，我会选出经过认真思考的留言，送给你一份学习奖励礼券，欢迎你与我一起讨论。</p><p>你的朋友是不是也在准备面试呢？你可以“请朋友读”，把今天的题目分享给好友，或许你能帮到他。</p><p>点击下方图片进入JVM专栏<br/><a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/intro/108?utm_source=app&amp;utm_medium=article&amp;utm_campaign=108-presell&amp;utm_content=java"><img src="/blog-test/static/httpsstatic001geekbangorgresourceimage2ad52a62e58cbdf56a5dc40748567d346fd5.d52c8944.jpg" alt=""/></a></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/java核心技术面试精讲/05.模块四Java性能基础/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 09:43:57</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-test/umi.3ded5539.js"></script>
  </body>
</html>
