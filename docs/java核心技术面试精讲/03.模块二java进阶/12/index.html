<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-test/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-test";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>第26讲 | 如何监控和诊断JVM堆内和堆外内存使用？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/java核心技术面试精讲/03.模块二java进阶/12" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></span><span>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></li><li>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/java核心技术面试精讲/01.开篇词">01.开篇词</a><ul><li><a href="/blog-test/java核心技术面试精讲/01.开篇词/01"><span>开篇词 | 以面试题为切入点，有效提升你的Java内功</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础">02.模块一Java基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/01"><span>第1讲 | 谈谈你对Java平台的理解？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/02"><span>第2讲 | Exception和Error有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/03"><span>第3讲 | 谈谈final、finally、 finalize有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/04"><span>第4讲 | 强引用、软引用、弱引用、幻象引用有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/05"><span>第5讲 | String、StringBuffer、StringBuilder有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/06"><span>第6讲 | 动态代理是基于什么原理？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/07"><span>第7讲 | int和Integer有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/08"><span>第8讲 | 对比Vector、ArrayList、LinkedList有何区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/09"><span>第9讲 | 对比Hashtable、HashMap、TreeMap有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/10"><span>第10讲 | 如何保证集合是线程安全的? ConcurrentHashMap如何实现高效地线程安全？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/11"><span>第11讲 | Java提供了哪些IO方式？ NIO如何实现多路复用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/12"><span>第12讲 | Java有几种文件拷贝方式？哪一种最高效？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/13"><span>第13讲 | 谈谈接口和抽象类有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/14"><span>第14讲 | 谈谈你知道的设计模式？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/03.模块二java进阶">03.模块二Java进阶</a><ul><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/01"><span>第15讲 | synchronized和ReentrantLock有什么区别呢？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/02"><span>第16讲 | synchronized底层如何实现？什么是锁的升级、降级？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/03"><span>第17讲 | 一个线程两次调用start()方法会出现什么情况？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/04"><span>第18讲 | 什么情况下Java程序会产生死锁？如何定位、修复？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/05"><span>第19讲 | Java并发包提供了哪些并发工具类？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/06"><span>第20讲 | 并发包中的ConcurrentLinkedQueue和LinkedBlockingQueue有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/07"><span>第21讲 | Java并发类库提供的线程池有哪几种？ 分别有什么特点？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/08"><span>第22讲 | AtomicInteger底层实现原理是什么？如何在自己的产品代码中应用CAS操作？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/09"><span>第23讲 | 请介绍类加载过程，什么是双亲委派模型？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/10"><span>第24讲 | 有哪些方法可以在运行时动态生成一个Java类？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11"><span>第25讲 | 谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError?</span></a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12"><span>第26讲 | 如何监控和诊断JVM堆内和堆外内存使用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/13"><span>第27讲 | Java常见的垃圾收集器有哪些？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/14"><span>第28讲 | 谈谈你的GC调优思路?</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/15"><span>第29讲 | Java内存模型中的happen-before是什么？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/16"><span>第30讲 | Java程序运行在Docker等容器环境有哪些新问题？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础">04.模块三Java安全基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/01"><span>第31讲 | 你了解Java应用开发中的注入攻击吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/02"><span>第32讲 | 如何写出安全的Java代码？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础">05.模块四Java性能基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/01"><span>第33讲 | 后台服务出现明显“变慢”，谈谈你的诊断思路？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/02"><span>第34讲 | 有人说“Lambda能让Java程序慢30倍”，你怎么看？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03"><span>第35讲 | JVM优化Java代码时都做了什么？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展">06.模块5Java应用开发扩展</a><ul><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/01"><span>第36讲 | 谈谈MySQL支持的事务隔离级别，以及悲观锁和乐观锁的原理和应用场景？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/02"><span>第37讲 | 谈谈Spring Bean的生命周期和作用域？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/03"><span>第38讲 | 对比Java标准NIO类库，你知道Netty是如何实现更高性能的吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/04"><span>第39讲 | 谈谈常用的分布式ID的设计方案？Snowflake是否受冬令时切换影响？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利">07.周末福利</a><ul><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/01"><span>周末福利 | 谈谈我对Java学习和面试的看法</span></a></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/02"><span>周末福利 | 一份Java工程师必读书单</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语">08.结束语</a><ul><li><a href="/blog-test/java核心技术面试精讲/08.结束语/01"><span>结束语 | 技术没有终点</span></a></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语/02"><span>结课测试 | Java核心技术的这些知识，你真的掌握了吗？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/summary">java核心技术面试精讲</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="典型回答" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#典型回答"><span>典型回答</span></a></li><li title="考点分析" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#考点分析"><span>考点分析</span></a></li><li title="知识扩展" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#知识扩展"><span>知识扩展</span></a></li><li title="一课一练" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#一课一练"><span>一课一练</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="第26讲--如何监控和诊断jvm堆内和堆外内存使用"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#第26讲--如何监控和诊断jvm堆内和堆外内存使用"><span class="icon icon-link"></span></a>第26讲 | 如何监控和诊断JVM堆内和堆外内存使用？</h1><p>上一讲我介绍了JVM内存区域的划分，总结了相关的一些概念，今天我将结合JVM参数、工具等方面，进一步分析JVM内存结构，包括外部资料相对较少的堆外部分。</p><p>今天我要问你的问题是，如何监控和诊断JVM堆内和堆外内存使用？</p><h2 id="典型回答"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#典型回答"><span class="icon icon-link"></span></a>典型回答</h2><p>了解JVM内存的方法有很多，具体能力范围也有区别，简单总结如下：</p><ul><li>可以使用综合性的图形化工具，如JConsole、VisualVM（注意，从Oracle JDK 9开始，VisualVM已经不再包含在JDK安装包中）等。这些工具具体使用起来相对比较直观，直接连接到Java进程，然后就可以在图形化界面里掌握内存使用情况。</li></ul><p>以JConsole为例，其内存页面可以显示常见的<strong>堆内存</strong>和<strong>各种堆外部分</strong>使用状态。</p><ul><li><p>也可以使用命令行工具进行运行时查询，如jstat和jmap等工具都提供了一些选项，可以查看堆、方法区等使用数据。</p></li><li><p>或者，也可以使用jmap等提供的命令，生成堆转储（Heap Dump）文件，然后利用jhat或Eclipse MAT等堆转储分析工具进行详细分析。</p></li><li><p>如果你使用的是Tomcat、Weblogic等Java EE服务器，这些服务器同样提供了内存管理相关的功能。</p></li><li><p>另外，从某种程度上来说，GC日志等输出，同样包含着丰富的信息。</p></li></ul><p>这里有一个相对特殊的部分，就是是堆外内存中的直接内存，前面的工具基本不适用，可以使用JDK自带的Native Memory Tracking（NMT）特性，它会从JVM本地内存分配的角度进行解读。</p><h2 id="考点分析"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#考点分析"><span class="icon icon-link"></span></a>考点分析</h2><p>今天选取的问题是Java内存管理相关的基础实践，对于普通的内存问题，掌握上面我给出的典型工具和方法就足够了。这个问题也可以理解为考察两个基本方面能力，第一，你是否真的理解了JVM的内部结构；第二，具体到特定内存区域，应该使用什么工具或者特性去定位，可以用什么参数调整。</p><p>对于JConsole等工具的使用细节，我在专栏里不再赘述，如果你还没有接触过，你可以参考<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/7/docs/technotes/guides/management/jconsole.html">JConsole官方教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。我这里特别推荐<a target="_blank" rel="noopener noreferrer" href="http://www.oracle.com/technetwork/java/javaseproducts/mission-control/java-mission-control-1998576.html">Java Mission Control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（JMC），这是一个非常强大的工具，不仅仅能够使用<a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Java_Management_Extensions">JMX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行普通的管理、监控任务，还可以配合<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH171">Java Flight Recorder<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（JFR）技术，以非常低的开销，收集和分析JVM底层的Profiling和事件等信息。目前， Oracle已经将其开源，如果你有兴趣请可以查看OpenJDK的<a target="_blank" rel="noopener noreferrer" href="http://openjdk.java.net/projects/jmc/">Mission Control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>项目。</p><p>关于内存监控与诊断，我会在知识扩展部分结合JVM参数和特性，尽量从庞杂的概念和JVM参数选项中，梳理出相对清晰的框架：</p><ul><li><p>细化对各部分内存区域的理解，堆内结构是怎样的？如何通过参数调整？</p></li><li><p>堆外内存到底包括哪些部分？具体大小受哪些因素影响？</p></li></ul><h2 id="知识扩展"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#知识扩展"><span class="icon icon-link"></span></a>知识扩展</h2><p>今天的分析，我会结合相关JVM参数和工具，进行对比以加深你对内存区域更细粒度的理解。</p><p>首先，堆内部是什么结构？</p><p>对于堆内存，我在上一讲介绍了最常见的新生代和老年代的划分，其内部结构随着JVM的发展和新GC方式的引入，可以有不同角度的理解，下图就是年代视角的堆结构示意图。<br/><img src="data:image/png;base64,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" alt=""/></p><p>你可以看到，按照通常的GC年代方式划分，Java堆内分为：</p><p>1.新生代</p><p>新生代是大部分对象创建和销毁的区域，在通常的Java应用中，绝大部分对象生命周期都是很短暂的。其内部又分为Eden区域，作为对象初始分配的区域；两个Survivor，有时候也叫from、to区域，被用来放置从Minor GC中保留下来的对象。</p><ul><li><p>JVM会随意选取一个Survivor区域作为“to”，然后会在GC过程中进行区域间拷贝，也就是将Eden中存活下来的对象和from区域的对象，拷贝到这个“to”区域。这种设计主要是为了防止内存的碎片化，并进一步清理无用对象。</p></li><li><p>从内存模型而不是垃圾收集的角度，对Eden区域继续进行划分，Hotspot JVM还有一个概念叫做Thread Local Allocation Buffer（TLAB），据我所知所有OpenJDK衍生出来的JVM都提供了TLAB的设计。这是JVM为每个线程分配的一个私有缓存区域，否则，多线程同时分配内存时，为避免操作同一地址，可能需要使用加锁等机制，进而影响分配速度，你可以参考下面的示意图。从图中可以看出，TLAB仍然在堆上，它是分配在Eden区域内的。其内部结构比较直观易懂，start、end就是起始地址，top（指针）则表示已经分配到哪里了。所以我们分配新对象，JVM就会移动top，当top和end相遇时，即表示该缓存已满，JVM会试图再从Eden里分配一块儿。<br/><img src="data:image/png;base64,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" alt=""/></p></li></ul><p>2.老年代</p><p>放置长生命周期的对象，通常都是从Survivor区域拷贝过来的对象。当然，也有特殊情况，我们知道普通的对象会被分配在TLAB上；如果对象较大，JVM会试图直接分配在Eden其他位置上；如果对象太大，完全无法在新生代找到足够长的连续空闲空间，JVM就会直接分配到老年代。</p><p>3.永久代</p><p>这部分就是早期Hotspot JVM的方法区实现方式了，储存Java类元数据、常量池、Intern字符串缓存，在JDK 8之后就不存在永久代这块儿了。</p><p>那么，我们如何利用JVM参数，直接影响堆和内部区域的大小呢？我来简单总结一下：</p><ul><li>最大堆体积</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-Xmx value</span></div></pre></div><ul><li>初始的最小堆体积</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-Xms value</span></div></pre></div><ul><li>老年代和新生代的比例</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:NewRatio=value</span></div></pre></div><p>默认情况下，这个数值是2，意味着老年代是新生代的2倍大；换句话说，新生代是堆大小的1/3。</p><ul><li>当然，也可以不用比例的方式调整新生代的大小，直接指定下面的参数，设定具体的内存大小数值。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:NewSize=value</span></div></pre></div><ul><li>Eden和Survivor的大小是按照比例设置的，如果SurvivorRatio是8，那么Survivor区域就是Eden的1/8大小，也就是新生代的1/10，因为YoungGen=Eden + 2*Survivor，JVM参数格式是</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:SurvivorRatio=value</span></div></pre></div><ul><li>TLAB当然也可以调整，JVM实现了复杂的适应策略，如果你有兴趣可以参考这篇<a target="_blank" rel="noopener noreferrer" href="https://blogs.oracle.com/jonthecollector/the-real-thing">说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul><p>不知道你有没有注意到，我在年代视角的堆结构示意图也就是第一张图中，还标记出了Virtual区域，这是块儿什么区域呢？</p><p>在JVM内部，如果Xms小于Xmx，堆的大小并不会直接扩展到其上限，也就是说保留的空间（reserved）大于实际能够使用的空间（committed）。当内存需求不断增长的时候，JVM会逐渐扩展新生代等区域的大小，所以Virtual区域代表的就是暂时不可用（uncommitted）的空间。</p><p>第二，分析完堆内空间，我们一起来看看JVM堆外内存到底包括什么？</p><p>在JMC或JConsole的内存管理界面，会统计部分非堆内存，但提供的信息相对有限，下图就是JMC活动内存池的截图。<br/><img src="/blog-test/static/httpsstatic001geekbangorgresourceimagefa2efa491795ffe21c1f49982de8b7810c2e.522d7445.png" alt=""/></p><p>接下来我会依赖NMT特性对JVM进行分析，它所提供的详细分类信息，非常有助于理解JVM内部实现。</p><p>首先来做些准备工作，开启NMT并选择summary模式，</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:NativeMemoryTracking=summary</span></div></pre></div><p>为了方便获取和对比NMT输出，选择在应用退出时打印NMT统计信息</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics</span></div></pre></div><p>然后，执行一个简单的在标准输出打印HelloWorld的程序，就可以得到下面的输出<br/><img src="data:image/png;base64,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" alt=""/></p><p>我来仔细分析一下，NMT所表征的JVM本地内存使用：</p><ul><li><p>第一部分非常明显是Java堆，我已经分析过使用什么参数调整，不再赘述。</p><ul><li>第二部分是Class内存占用，它所统计的就是Java类元数据所占用的空间，JVM可以通过类似下面的参数调整其大小：</li></ul></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:MaxMetaspaceSize=value</span></div></pre></div><p>对于本例，因为HelloWorld没有什么用户类库，所以其内存占用主要是启动类加载器（Bootstrap）加载的核心类库。你可以使用下面的小技巧，调整启动类加载器元数据区，这主要是为了对比以加深理解，也许只有在hack JDK时才有实际意义。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:InitialBootClassLoaderMetaspaceSize=30720</span></div></pre></div><ul><li>下面是Thread，这里既包括Java线程，如程序主线程、Cleaner线程等，也包括GC等本地线程。你有没有注意到，即使是一个HelloWorld程序，这个线程数量竟然还有25。似乎有很多浪费，设想我们要用Java作为Serverless运行时，每个function是非常短暂的，如何降低线程数量呢？<br/>如果你充分理解了专栏讲解的内容，对JVM内部有了充分理解，思路就很清晰了：<br/>JDK 9的默认GC是G1，虽然它在较大堆场景表现良好，但本身就会比传统的Parallel GC或者Serial GC之类复杂太多，所以要么降低其并行线程数目，要么直接切换GC类型；<br/>JIT编译默认是开启了TieredCompilation的，将其关闭，那么JIT也会变得简单，相应本地线程也会减少。<br/>我们来对比一下，这是默认参数情况的输出：<br/><img src="data:image/png;base64,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" alt=""/></li></ul><p>下面是替换了默认GC，并关闭TieredCompilation的命令行<br/><img src="/blog-test/static/httpsstatic001geekbangorgresourceimageb03bb07d6da56f588cbfadbb7b381346213b.9d7bfd50.png" alt=""/></p><p>得到的统计信息如下，线程数目从25降到了17，消耗的内存也下降了大概1/3。<br/><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnoAAABVCAAAAAD7pBYaAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAAd0SU1FB+cJGwEaHZ90z0AAAAABb3JOVAHPoneaAAAE5ElEQVR42u2cCZbqIBBF2f+qWNo/X4EaKIZo7LSde8+xEwlTwrMKodqUAADg95EfPI4bWX3Cu03b9z659OuZIIfHhZb+Srs/0a83H84NyI/nlbYelR+SdYkj9ZV3klhHsyW3IdWvl5utZfMow5v9QntLuke7yhm+e6Plcv58Z0Y4x0NshvrdxoM6TuoX2lsh0quOVzsSc8xRsUl+dV0Nka3PeSjt1by6tqTXt18nFN5Bhuln9usq7b0xGfnpjtb+1seW3eMN/Zu66OXl/c70uqtQD3iThs+gMwZ34165yCIbFTmr94l+fcXwX0n37MtQ6U//VHo+f002Zs8MWTbS7KyL5MuqKWudR1Yv+LhsSu/8fiG9BcHHPoVDGFqD4DHbSXZc/cS69NMwU+HHpHd6v1DeirH05g6y+9APHW7J4BzW3hCH9Xnz5GrZdbh6jvaJfl0znt+D8ovVcer06jDb0RRNYf5s682SO6hXdaMroBoQhyj9lIr6+9FSdxZJ37Ecz+4XyvvzMMQAAAAAAAAA8K3odY28XuTo1n7rwlq5WBfIrr4t+PVo5WxJJpae+staLOwQbH7ulSjnTysnmwjJqBBgRB+hYvfboo21bMt3SiPiAzbowzjaPrw6bVm6aVwgvQMGFG5MFEGkzJ7Zds9b0utPACImgX2D5GiuF9g6lAcLurg3L71pHFxn9XC3sI2Ol9PxauXiPN5PkrORIMoDAAAAAAAAAAD4KDtLcBtxfMebtVVmk+zDFpLs79n/3z39ds/pF+uaG8RPepHr/IbtUnSwe5K73ZbX+mTjE4P7PadfaG9J8FME02zn2T+/F9yn6SG2QV1vSM82HtRxUr/Q3gL7MxA2UiUl++zND020YuO4PnVdF2/XXYO6O9KkDOmW9Pr2s/+djFn6mf1Ce3OcI9HPy/uP8FG6uL7I70yvu47IFM5LaCDd4HbcqwR/JRvn4KzeJ/qF9OaMAk6aVUjyPi5fhtYYCWNNkpGe1DuyLi5QS1mnmpAijXS3cUx65/cL6S0wX9RCK1AT2sc6KO6Mpa+1q29sXUL5mIo/I73T+4XylnjHMXSczRx0pWNnajToHNRqiKN8cQW2P0cc7vR+T+jXhWP6LZi5iprLNA9ZU0MrozxWcBQ/3eezptIV8MdyJs5NVxR0SLtLa5H0HZn7PbVfKO/PwxADAAAAAAAAwNWE6xP9+tW8vFv/k3U3yTRYP7z69uEyRoO/uwveVpun2xVu10Cuob3bMhz6TenlTnrRHmsuZjBQJdq7KS5yo9/5SvEGUi0QWLNwe1/25aJLcENk+z+rc3VY+lGZw9VjUu9VRjcnxOXeHC890cRQeiW1bpuL2GpFuoBqR76BBJEfcD9EMck6w7n0uhrm0ovmeq4duB1tirYrPa8Vs0qy+Q1XLqO8G+MWRpTjdcdn5l55tVw6sK5n3TQAAAAAAAAAAAAc5MWltVwKH4vTYz0PGq8qL9e/R+L02MWAxmsS0MZrJ05P52XvFv5jfr5B/e6DD24ywVA5RVZvFrFim7JHuCc+XLhENUX+00pFx5imdZxeyl01SO/eaKuXUzN7EjUQhIJG/1yxbfXkItK7OcHXhWQtXRwstSc9P9dDeSBYxQzC7sbSI04PXsY72pLoJZl7a5YOx+n1/hoAAAAAAAAAAAAAAAC+kn8H1rMI5nI/EQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wOS0yN1QwMToyNjoyOSswMDowMJ07bHAAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDktMjdUMDE6MjY6MjkrMDA6MDDsZtTMAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDIzLTA5LTI3VDAxOjI2OjI5KzAwOjAwu3P1EwAAAABJRU5ErkJggg==" alt=""/></p><ul><li>接下来是Code统计信息，显然这是CodeCache相关内存，也就是JIT compiler存储编译热点方法等信息的地方，JVM提供了一系列参数可以限制其初始值和最大值等，例如：</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:InitialCodeCacheSize=value</span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:ReservedCodeCacheSize=value</span></div></pre></div><p>你可以设置下列JVM参数，也可以只设置其中一个，进一步判断不同参数对CodeCache大小的影响。<br/><img src="data:image/png;base64,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" alt=""/><br/><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoEAAAA8CAAAAAA88z/mAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAAd0SU1FB+cJGwEaI14V0usAAAABb3JOVAHPoneaAAAEQUlEQVR42u2aDXKEIAyFuW5v1aPkaO1MBfKrrK4bLO/NtK6KJMK3CQuU768CQYkCgVCunkwg/UpfiEpeNeTUt5knqn70A9Wz379+/4Tdl/xqp8QrMH5cbIx368EEbi2rLwUlL5sSp9TNt3vbh3bNLXTGbDOw75d2pCJp/JgLwecS6DWm37bXW9zEGrJw8WP1TRBw1bhTB7/Ui6lP1o+pEHw4gX8fevajwrtAFKTeEyJb8qypQoWtt2W0mMD2+YhAa3+rXr5HdF371U30YBz5MROC3190YaCSKR1zwqTHCpJDj4xZdFifIJQUCNyiJsXxX/3RRgu1GvSLlj2/SPAVfpPKbARme3BWMYGqx1lSKs6InMcWGd9ktu2xhnqfFuuDF4P2MujrBEZ+FfWYjNnzxsBsD86KZ5j9Qb9sdnZfDiWdGMPP4xqDgf5tBPp+ecM8jANvVTAmczpch6YwC28FRIfFBMps59ang5V1f4jAkW/bHoH+i86hBxPYUWlpp6VPU5Jd5uMipxqR7ni92nBQX09+VMeWrCLrPidexateY2HPR34p+/WK8WMuAB9N4MM0Wc/PIhAI5QoEQrkCgVCuQCCUKxAI5QoEQrlag0B3IkTPC8YPi/k4O8/XjeiJRWUnuxmm1BIERn0/tFDvrbZFixLe+vCki2HTaAUCw55/iUC+COyt95JYjJChdcINAdNoAQKdPTAk7hSz2kXigTEC2/ViY94Q6otqJQLbir+OSUc7Efp6aymKUFlKrv+yrQ7SFYhpQQJlaGtHJ9uKpXw+HkQMfJ8WILDzUHc/HcZA5/FDAvU40CEQADpagcAOziiB3r67eN9fL4jfwq9rCQI1PSwbq+NfYTW8k79gRucDzS8fAOhqDQKheQUCoVyBQChXIBDKFQiEcgUCoVyBQChXaxD44ak40vZ25wnLwTzj+16T5AS6ma/0/bi58ZYg8ONzwWZnA9lllOF9hy+brc9SVEB8Pl7zubf5ViBwtAXPhp4ji0QRXEO7vs4ad+oYJVD5cSuCCxCo9gfaVbaKnlmNE9nTy1aq5+SurW7wcM25nuwSaO0H7+Nf137xvWN8sdLz404EVyKw7UyQ+wTjHjeU2Vixc5+Z5xsM+zCP+GVLivMa6k+/j4xYak+P9cv/Znl+gMBLigjsMSGMOcUZkfPYIuObzLY91rC+li4dZT/vNU4Q6PvF6iJ+RAx8v1rHiB4zI++iQo9tfTkud2IMP9+r6rME7vuFceAH1Br2LIFRT20FRDUxgf1/WJ8OVqqO0SzMSToaHYz4cWfnLEFg9P2W2dg8w9KYczSjJHZfdVpNg0f11VTIKnIcYsTr9yFBrrWjEBzz414AFyFwVze38L/z680CgX4EhD4lEAjlCgRCuQKBUK5AIJQrEAjlCgRCuQKBUK5AIJQrEAjlCgRCuQKBUK5AIJQrEAjlCgRCuQKBUKp+AIecgcZHDsRcAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA5LTI3VDAxOjI2OjM1KzAwOjAwljEGmgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wOS0yN1QwMToyNjozNSswMDowMOdsviYAAAAodEVYdGRhdGU6dGltZXN0YW1wADIwMjMtMDktMjdUMDE6MjY6MzUrMDA6MDCweZ/5AAAAAElFTkSuQmCC" alt=""/></p><p>很明显，CodeCache空间下降非常大，这是因为我们关闭了复杂的TieredCompilation，而且还限制了其初始大小。</p><ul><li>下面就是GC部分了，就像我前面介绍的，G1等垃圾收集器其本身的设施和数据结构就非常复杂和庞大，例如Remembered Set通常都会占用20%~30%的堆空间。如果我把GC明确修改为相对简单的Serial GC，会有什么效果呢？</li></ul><p>使用命令：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+UseSerialGC</span></div></pre></div><p><img src="data:image/png;base64,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" alt=""/></p><p>可见，不仅总线程数大大降低（25 → 13），而且GC设施本身的内存开销就少了非常多。据我所知，AWS Lambda中Java运行时就是使用的Serial GC，可以大大降低单个function的启动和运行开销。</p><ul><li><p>Compiler部分，就是JIT的开销，显然关闭TieredCompilation会降低内存使用。</p></li><li><p>其他一些部分占比都非常低，通常也不会出现内存使用问题，请参考<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr022.html#BABCBGFA">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。唯一的例外就是Internal（JDK 11以后在Other部分）部分，其统计信息<strong>包含着Direct Buffer的直接内存</strong>，这其实是堆外内存中比较敏感的部分，很多堆外内存OOM就发生在这里，请参考专栏第12讲的处理步骤。原则上Direct Buffer是不推荐频繁创建或销毁的，如果你怀疑直接内存区域有问题，通常可以通过类似instrument构造函数等手段，排查可能的问题。</p></li></ul><p>JVM内部结构就介绍到这里，主要目的是为了加深理解，很多方面只有在定制或调优JVM运行时才能真正涉及，随着微服务和Serverless等技术的兴起，JDK确实存在着为新特征的工作负载进行定制的需求。</p><p>今天我结合JVM参数和特性，系统地分析了JVM堆内和堆外内存结构，相信你一定对JVM内存结构有了比较深入的了解，在定制Java运行时或者处理OOM等问题的时候，思路也会更加清晰。JVM问题千奇百怪，如果你能快速将问题缩小，大致就能清楚问题可能出在哪里，例如如果定位到问题可能是堆内存泄漏，往往就已经有非常清晰的<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/memleaks004.html#CIHIEEFH">思路和工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以去解决了。</p><h2 id="一课一练"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12#一课一练"><span class="icon icon-link"></span></a>一课一练</h2><p>关于今天我们讨论的题目你做到心中有数了吗？今天的思考题是，如果用程序的方式而不是工具，对Java内存使用进行监控，有哪些技术可以做到?</p><p>请你在留言区写写你对这个问题的思考，我会选出经过认真思考的留言，送给你一份学习奖励礼券，欢迎你与我一起讨论。</p><p>你的朋友是不是也在准备面试呢？你可以“请朋友读”，把今天的题目分享给好友，或许你能帮到他。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/java核心技术面试精讲/03.模块二Java进阶/12.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 09:43:57</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-test/umi.3ded5539.js"></script>
  </body>
</html>
