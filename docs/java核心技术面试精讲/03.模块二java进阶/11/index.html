<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-test/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-test";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>
      第25讲 | 谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError? - 大师兄
    </title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/java核心技术面试精讲/03.模块二java进阶/11" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></span><span>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-test/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>java开发<ul><li><a href="/blog-test/java业务开发常见错误100例">java业务开发常见错误100例</a></li><li><a href="/blog-test/java并发编程实战">java并发编程实战</a></li><li><a href="/blog-test/java性能调优实战">java性能调优实战</a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/spring编程常见错误50例">spring编程常见错误50例</a></li><li><a href="/blog-test/深入剖析java新特性">深入剖析java新特性</a></li><li><a href="/blog-test/深入拆解java虚拟机">深入拆解java虚拟机</a></li></ul></li><li>架构师<ul><li><a href="/blog-test/rpc实战与核心原理">rpc实战与核心原理</a></li><li><a href="/blog-test/从0开始学微服务">从0开始学微服务</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-test/java核心技术面试精讲">java核心技术面试精讲</a></li><li><a href="/blog-test/java核心技术面试精讲/01.开篇词">01.开篇词</a><ul><li><a href="/blog-test/java核心技术面试精讲/01.开篇词/01"><span>开篇词 | 以面试题为切入点，有效提升你的Java内功</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础">02.模块一Java基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/01"><span>第1讲 | 谈谈你对Java平台的理解？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/02"><span>第2讲 | Exception和Error有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/03"><span>第3讲 | 谈谈final、finally、 finalize有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/04"><span>第4讲 | 强引用、软引用、弱引用、幻象引用有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/05"><span>第5讲 | String、StringBuffer、StringBuilder有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/06"><span>第6讲 | 动态代理是基于什么原理？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/07"><span>第7讲 | int和Integer有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/08"><span>第8讲 | 对比Vector、ArrayList、LinkedList有何区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/09"><span>第9讲 | 对比Hashtable、HashMap、TreeMap有什么不同？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/10"><span>第10讲 | 如何保证集合是线程安全的? ConcurrentHashMap如何实现高效地线程安全？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/11"><span>第11讲 | Java提供了哪些IO方式？ NIO如何实现多路复用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/12"><span>第12讲 | Java有几种文件拷贝方式？哪一种最高效？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/13"><span>第13讲 | 谈谈接口和抽象类有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/02.模块一java基础/14"><span>第14讲 | 谈谈你知道的设计模式？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/03.模块二java进阶">03.模块二Java进阶</a><ul><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/01"><span>第15讲 | synchronized和ReentrantLock有什么区别呢？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/02"><span>第16讲 | synchronized底层如何实现？什么是锁的升级、降级？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/03"><span>第17讲 | 一个线程两次调用start()方法会出现什么情况？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/04"><span>第18讲 | 什么情况下Java程序会产生死锁？如何定位、修复？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/05"><span>第19讲 | Java并发包提供了哪些并发工具类？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/06"><span>第20讲 | 并发包中的ConcurrentLinkedQueue和LinkedBlockingQueue有什么区别？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/07"><span>第21讲 | Java并发类库提供的线程池有哪几种？ 分别有什么特点？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/08"><span>第22讲 | AtomicInteger底层实现原理是什么？如何在自己的产品代码中应用CAS操作？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/09"><span>第23讲 | 请介绍类加载过程，什么是双亲委派模型？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/10"><span>第24讲 | 有哪些方法可以在运行时动态生成一个Java类？</span></a></li><li><a aria-current="page" class="active" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11"><span>第25讲 | 谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError?</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/12"><span>第26讲 | 如何监控和诊断JVM堆内和堆外内存使用？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/13"><span>第27讲 | Java常见的垃圾收集器有哪些？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/14"><span>第28讲 | 谈谈你的GC调优思路?</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/15"><span>第29讲 | Java内存模型中的happen-before是什么？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/16"><span>第30讲 | Java程序运行在Docker等容器环境有哪些新问题？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础">04.模块三Java安全基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/01"><span>第31讲 | 你了解Java应用开发中的注入攻击吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/04.模块三java安全基础/02"><span>第32讲 | 如何写出安全的Java代码？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础">05.模块四Java性能基础</a><ul><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/01"><span>第33讲 | 后台服务出现明显“变慢”，谈谈你的诊断思路？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/02"><span>第34讲 | 有人说“Lambda能让Java程序慢30倍”，你怎么看？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/05.模块四java性能基础/03"><span>第35讲 | JVM优化Java代码时都做了什么？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展">06.模块5Java应用开发扩展</a><ul><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/01"><span>第36讲 | 谈谈MySQL支持的事务隔离级别，以及悲观锁和乐观锁的原理和应用场景？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/02"><span>第37讲 | 谈谈Spring Bean的生命周期和作用域？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/03"><span>第38讲 | 对比Java标准NIO类库，你知道Netty是如何实现更高性能的吗？</span></a></li><li><a href="/blog-test/java核心技术面试精讲/06.模块5java应用开发扩展/04"><span>第39讲 | 谈谈常用的分布式ID的设计方案？Snowflake是否受冬令时切换影响？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利">07.周末福利</a><ul><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/01"><span>周末福利 | 谈谈我对Java学习和面试的看法</span></a></li><li><a href="/blog-test/java核心技术面试精讲/07.周末福利/02"><span>周末福利 | 一份Java工程师必读书单</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语">08.结束语</a><ul><li><a href="/blog-test/java核心技术面试精讲/08.结束语/01"><span>结束语 | 技术没有终点</span></a></li><li><a href="/blog-test/java核心技术面试精讲/08.结束语/02"><span>结课测试 | Java核心技术的这些知识，你真的掌握了吗？</span></a></li></ul></li><li><a href="/blog-test/java核心技术面试精讲/summary">java核心技术面试精讲</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="典型回答" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#典型回答"><span>典型回答</span></a></li><li title="考点分析" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#考点分析"><span>考点分析</span></a></li><li title="知识扩展" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#知识扩展"><span>知识扩展</span></a></li><li title="一课一练" data-depth="2"><a href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#一课一练"><span>一课一练</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="第25讲--谈谈jvm内存区域的划分哪些区域可能发生outofmemoryerror"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#第25讲--谈谈jvm内存区域的划分哪些区域可能发生outofmemoryerror"><span class="icon icon-link"></span></a>第25讲 | 谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError?</h1><p>今天，我将从内存管理的角度，进一步探索Java虚拟机（JVM）。垃圾收集机制为我们打理了很多繁琐的工作，大大提高了开发的效率，但是，垃圾收集也不是万能的，懂得JVM内部的内存结构、工作机制，是设计高扩展性应用和诊断运行时问题的基础，也是Java工程师进阶的必备能力。</p><p>今天我要问你的问题是，谈谈JVM内存区域的划分，哪些区域可能发生OutOfMemoryError？</p><h2 id="典型回答"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#典型回答"><span class="icon icon-link"></span></a>典型回答</h2><p>通常可以把JVM内存区域分为下面几个方面，其中，有的区域是以线程为单位，而有的区域则是整个JVM进程唯一的。</p><p>首先，<strong>程序计数器</strong>（PC，Program Counter Register）。在JVM规范中，每个线程都有它自己的程序计数器，并且任何时间一个线程都只有一个方法在执行，也就是所谓的当前方法。程序计数器会存储当前线程正在执行的Java方法的JVM指令地址；或者，如果是在执行本地方法，则是未指定值（undefined）。</p><p>第二，<strong>Java虚拟机栈</strong>（Java Virtual Machine Stack），早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧（Stack Frame），对应着一次次的Java方法调用。</p><p>前面谈程序计数器时，提到了当前方法；同理，在一个时间点，对应的只会有一个活动的栈帧，通常叫作当前帧，方法所在的类叫作当前类。如果在该方法中调用了其他方法，对应的新的栈帧会被创建出来，成为新的当前帧，一直到它返回结果或者执行结束。JVM直接对Java栈的操作只有两个，就是对栈帧的压栈和出栈。</p><p>栈帧中存储着局部变量表、操作数（operand）栈、动态链接、方法正常退出或者异常退出的定义等。</p><p>第三，<strong>堆</strong>（Heap），它是Java内存管理的核心区域，用来放置Java对象实例，几乎所有创建的Java对象实例都是被直接分配在堆上。堆被所有的线程共享，在虚拟机启动时，我们指定的“Xmx”之类参数就是用来指定最大堆空间等指标。</p><p>理所当然，堆也是垃圾收集器重点照顾的区域，所以堆内空间还会被不同的垃圾收集器进行进一步的细分，最有名的就是新生代、老年代的划分。</p><p>第四，<strong>方法区</strong>（Method Area）。这也是所有线程共享的一块内存区域，用于存储所谓的元（Meta）数据，例如类结构信息，以及对应的运行时常量池、字段、方法代码等。</p><p>由于早期的Hotspot JVM实现，很多人习惯于将方法区称为永久代（Permanent Generation）。Oracle JDK 8中将永久代移除，同时增加了元数据区（Metaspace）。</p><p>第五，<strong>运行时常量池</strong>（Run-Time Constant Pool），这是方法区的一部分。如果仔细分析过反编译的类文件结构，你能看到版本号、字段、方法、超类、接口等各种信息，还有一项信息就是常量池。Java的常量池可以存放各种常量信息，不管是编译期生成的各种字面量，还是需要在运行时决定的符号引用，所以它比一般语言的符号表存储的信息更加宽泛。</p><p>第六，<strong>本地方法栈</strong>（Native Method Stack）。它和Java虚拟机栈是非常相似的，支持对本地方法的调用，也是每个线程都会创建一个。在Oracle Hotspot JVM中，本地方法栈和Java虚拟机栈是在同一块儿区域，这完全取决于技术实现的决定，并未在规范中强制。</p><h2 id="考点分析"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#考点分析"><span class="icon icon-link"></span></a>考点分析</h2><p>这是个JVM领域的基础题目，我给出的答案依据的是<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html#jvms-2.5">JVM规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中运行时数据区定义，这也和大多数书籍和资料解读的角度类似。</p><p>JVM内部的概念庞杂，对于初学者比较晦涩，我的建议是在工作之余，还是要去阅读经典书籍，比如我推荐过多次的《深入理解Java虚拟机》。</p><p>今天这一讲作为Java虚拟机内存管理的开篇，我会侧重于：</p><ul><li><p>分析广义上的JVM内存结构或者说Java进程内存结构。</p></li><li><p>谈到Java内存模型，不可避免的要涉及OutOfMemory（OOM）问题，那么在Java里面存在哪些种OOM的可能性，分别对应哪个内存区域的异常状况呢？</p></li></ul><p>注意，具体JVM的内存结构，其实取决于其实现，不同厂商的JVM，或者同一厂商发布的不同版本，都有可能存在一定差异。我在下面的分析中，还会介绍Oracle Hotspot JVM的部分设计变化。</p><h2 id="知识扩展"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#知识扩展"><span class="icon icon-link"></span></a>知识扩展</h2><p>首先，为了让你有个更加直观、清晰的印象，我画了一个简单的内存结构图，里面展示了我前面提到的堆、线程栈等区域，并从数量上说明了什么是线程私有，例如，程序计数器、Java栈等，以及什么是Java进程唯一。另外，还额外划分出了直接内存等区域。<br/><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAsIAAAHuCAMAAACiSpo7AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAADJUExURf///0FxnL3X7lub1ZLQUGCINAAAADxWIX+0RSk6FnCfPRQdC05wK/8AAP/a2v+Tk/9ubv/Hx/89Pf/s7P+xsTJHGwoOBWiUOXeqQYfBSh4qEFd8MEZkJv/19f/R0f9XV/8fH/+jo//j4/+Cgv+8vAwVHRkrOyVAWEZ3ozFTck+GuTxmi6LG58Tb8OHt9/n7/brV7c3g8tvp9m+n2u30+pO94/P4/IKz3+fw+a/O6tTl9P//AEdHAMPDAGlpAImJAKenAN3dACMjANHtYUsAAAABYktHRACIBR1IAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH5wkbARoGFREGrAAAAAFvck5UAc+id5oAACC5SURBVHja7d0JW+O22gZgnS9BECCrMxRopzM9bRYSGAjQhJ7CsPz/H/VpteUlcWK8SM7zXO3gOJtHudG8lm2FEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEARBEGRD/oMgVSRHwv+HIOUHhBHHA8KI4wFhxPGAMOJ4QBhxPCCMOB4QRhwPCCOOB4QRxwPCiOMBYcTxgDDieEAYcTwgjDgeEEYcDwgjjgeEEccDwojjAWHE8YAw4nhAGHE81RGu+tLtrKn6E0MiqZBww8mAsG0BYesJV/3Pju3/pIGw/YSbtQ0Ig7DjAWEQdjwgvE+ED+iB+HlIj5rsv3rEScJV7z9kjD2Eaat5fHJStb29Jlx1L5qt67WG8Ck9bjaP6WnV+EDYsdhD+KTF/2y1qsYHwo7FGsIHNMhh1QBB2KFUTfhYqT1qgTAIO02YdcK8Cj6sy5AECO8N4aYqJE5AGISdJnxKzVr4uGqAIOxQLCF8cngEwtUQrvrAxKePaFhCuNk8QiFREeGqe9HPdr4gDMJuBoRBGIRzJ4xaGIQdJnyI3TkQdpkwSwuFBAi7SlgenEMtDMKOEuZdsDhHGIQrJFz1EO/OY8E2ET7Sha9ZC9fgvHfHCLfdiJWE/YAwCDtPuCbXa4DwvhKuWUAYhLPm1I4rl0AYhLOmFR7TaBnlyRGN8D6lCc8AYXuzH4TNa6BP+DETsSQG62KE6cmRInya9x4kCINw5qipKPQFTeKGxBslfCC1c97HNOeuGIRBOEuCKz8OBWH/jkMx+hwl3KJNTZj32LmembFPhDtdEC6EsHEZ9DGN5ESuPTR8a9AgnJgeIf31dw2CW16w2CVD42FD0lOP6IDwhqjzNplJk/BJIuGW6ndPizgzrk6EO/IlvHbwciGFJtUh8RLWdzuS8IC02f96bU+92JA9Ui/tPeFj3rOy/09DhA9VAREuJA70SZ1B350j5ToRHvIX4AthwoP4u3jcrW84INxnXTgjPCBel8Ht+YSHbUm6S7r+7b0mHDrlOCB8qnfVwoT5gw7CnfMBCK9JXxLWna+3njB7qH6U0Tv3yIAR7vTFL0SwEoQ3EtY5pcGZRAbhQ8p24I7z7373iXByUdvRvWxyLeypLeqC8FrHsvsNutaDA/+ugPABbekaODZcDMJbE+6G3qQXfpJP2HhUt+cvoRZOI3wYzFycQPiQHvm7cUVMalwnwvo1YrVwFsJ9MXwhfiXQC8dzGhlU04RbNJLj5tFBMBJRxBHmPSFslA+8X5V7fj09hmE8uD3si052IEfgOsbYG6PLntnZZqhtrwgfpRBuGoNpp3nux9WQsICXXEiILrYn+lkxbLyWsDcckj4z3Jd9dWhsWLxCL9aJ7yVhHlVIiFMlNhQSJuHjAmaDrRfhISHxlZqw8OoZj43vzg1Z18vWs3qBDGVfPGxHihCVwcbt2APCx5QT5udbHnCfWxJu0lwPzNWQsMeKgHDf2jcLCc8sKRIIiyKBrx968kbX7HE9Yowl730vfHJywAgf0BO2u9bcnvCh+qoEjAsnpyc7yDjhfuRdNNVoL+yXIm05LtwPOvUhL5GHad3v3hDmKI/E8TlZG2xL+Fh0w7kOrtWKcIeVsT1lcOhjG5D+loSDh/XlzpvutUXp3FULacMRe0GY17+yFpY8tyXM9vda/rmXIBzvhJnVds/rhQn3jJMd1L7ccAvCbc8TdcQgUM+jjnhsPumt/oSl00N/n04QPqJJCRNu8jN/WjhHIjkeGahx3CCDthrMNQjLfjqxkOgQuUL1uJ6GbZYP4uX3vReWXFlfeigPVmxP+EivBOFYBmIsLE64b5yv0/c7YUl42AsRlnb1/p8ePtOvh6NzZnaZhCJ8kuVJvmdK1Ihwu2/ufwWFBDHO1zHO3+GEZUEQEO7xWrerntDVvS+OzlmdOhFuJxLuBufA98zT4YfEU91p6DQfDrcvH8xqYfEiIGx1akg4PPzQ9YKx3ZDVoMQ1VusTM7tsZUeNpIGw3ak94Y4qbHuKpoE1dr6wGG1grIcdPj4nu2r2s6deCrWwlakh4UiGg6B/Nc94GPoOjTPVdKHR0V13z0MvbHlqRtiSgDAIgzAIgzAIZyJ8WsS1QbnkYM2WgTAIh53YO/fwcfK2gTAIG9niFDL6pTLDyV8PAsIgbCR+bZu6wugsILxDoXF6QumXX9IedXa2zWs1g+tNQRiE1yXhuqDWJwi36Fan9GxNOLkbBmEQ3kgkdl7k9oTP6clx8+Igx+vuEyt1EAZhg2ecWxbCLfmQ49x3DRNLdRAGYUNIvNY0CB+zwuDwQio6uGRV7jlb+JUe/3pCz0JYfcInF3LFudwHFOdcfqEXLfaron5b+DytvJAwbl7wCvpSXARy1jo/CW1T0lQqIAzCfpK6zZZ52RsvigXhQ7l8zlleUnX2e5Rw85KqyzyPpXtBuCWewCSfi1+aL/Kq5uDmxaWeYoXDPqOhjjdpZmIQBmE/BwkTlahdsnO+dHjR/OWSkzqml8e8A/4iRiy+HLE/ze5RE2bdrUQcJnz2S/Ocvddvog8/kISDm6fitQ/O+Fuy3vi8eQ7CIJwPYalUFBK/yd0+DupU1ggn2tYXfb2RWM1rj1aUsBxlE+MQl2cXam4J/+alfO1T3q9TehHdGucJuxI3CW8sJBRDsTvnTzt1IakZtsKE2dNO2APChOULHjLKsvgWhP2b9DLYltiAnPuEXYxDhDfuziURPosTFjfM8pU/L4nwOXszeU2dgOrf3EjY/d05F+MQ4aQBM5/whVFIGOPHqYTFQJh0GSLcPDlTIiVUffNEFxK/xgnXYFDNxbhEuLXp0Mal2J07kVOZsN2s5jmfUW0D4S+H7Knnl/wBZwzkkZwEvhXMcvmbfK6Eqm8e8te+YLtzR3HCNTi04WJcIpxARNcMzeYv4qcYkdBrv2wkrB50ecH3/+RzTcJ8QomjgLC+eXEWfBtHlHDL/QPMLsYlwsHAgp9TnzAfUDv77eJMHqW4ZCJPL/g42K8xwipHh+xBJ/xBzYvfzujlL8fy0IYeJWupskCdI6FvXhwyxF+OjXv8F6zBaT4uxinC+R8TzjN1ONnSxThFWH8/p5WpxSnvLsYtwuyfc1v74XpceORiHCPsXkAYhB0PCIOw4wFhEHY8IAzCjgeEQdjxgDAIOx4QBmHHA8Ig7HhAGIQdj1uEq76eqOYXHrkZxwhXfV1nvS//dDMgDMKOB4RB2PGAMAg7HhAGYccDwiDseEAYhB0PCIOw4wFhEHY8IAzCjgeEQdjxgLCRjvoS8j4ZDPT3iIOw7QHhZMK9LumAsBMB4QTCQzJgf3rZDYMwCNtA+BMBYRDOnfDXr+l+RfpssUu68kbWehiEQTh3woRsS7hjbE0XhO0PCEcf1BfbMcz8TiAMwpUR7ukH9TJ3vyAMwoUSHvQ9Qn7/xosGsb82ZMVu7/ev5Gv/O7/Z16XD4JOdMAiDcEGEv4q3+Pq9/Qf5g6/0vra/ybftCLjsp7A90FuTdVgNhEG4GMLecNAe/M562gH5L7v5jfTb37zud/YHlztkgNvEGxpb44Gw/dkrwiJ/8irhd8LKib/8QTO+NOCDEe1ur/up/heEQbhIwt//+i9/jyEf+f2Ldcq8k/3G62M+AsxqCH1oQx3j6GSuiEEYhAsh/F3WwmJf7avX7vGFnnrfXptVFT5hvp/X/sTIGgiDcCGE/yD9QVvKbffJtz4vgH8nf3yXZIfBAWb+mO5WI8kgXH32gfC3/vdvfP9tyKuHXkcQ7pH+V17vdsifrKzwZFXsE2bieTXczaoYhEE4X8L8hf/SY2VfZX3gyTHgrloXJqyqjWHWkyRAGIRzJdzufiXi4MWfbG/u94EcEx7y8WH+0yNf//qTD1BowvwIx1D0yx30wg5kLwhvG0a2xzeiL3bzegNx2hoIWx4QDhNu99W5wqLCqNGZajUOCIcJ+xl84viGhYQbtQ0IFxEQBmEQBmEQBmEQBmEQdiEgDMKOB4RB2PGAMAg7HhAGYccDwiDseEAYhB0PCIOw4wFhEHY8IAzCjgeEQdjxgDAIOx7HCLsSEAbh+nwIIFx0A4Nw0S0cWwDhfBsYhItu4dgCCOfbwCBcdAvHFkA43wYG4aJbOLYAwvk2MAgX3cKxBRDOt4FBuOgWji2AcL4NDMJFt3BsAYTzbWCnCFd9xAKHNiyMY4SrPnKMA8z2BYRB2PGAMAg7HhAGYccDwiDseEAYhB0PCIOw4wFhEHY8IAzCjgeEQdjxgDAIOx4QBmHHA8Ig7Hj2nrCX+evuQdiO7DvhLlFflRhL5q/+BGEQ/jThHgl1rd3g28Dj34Y4NFd1jWWTsP5OxT4ZDLb5anEQBuHyCIdWeUafvIZwr7vFl4KCMAgXQNjrGF57Se89FN9aq5+aRHgohHuphkEYhKsizB6hvzp8PeH0gDAIZyI8THg9L054KFZK24lfde+FXXfkQl8+Qd5IqYdBGIQLI+yvlE/YhXDHWNvduCEgDMLZCOsMTGMD+bodTlja7HTWEe4R44ZZSBB+R1+R3iIgDMKfIux5xPMxasI+ZVbZBoTDBUHHFGoQ7hGiF1K6XxAG4RwIM5hk2DFHe5nUvvznXxD2RxT6xhv3VXereZuE+7pbH2zXCYMwCH+GMNvlYoTNQQlOeCg74DBhs7pVYDv+0wLCvAPviLGIgX50yrAaCINwdsI9Ro/7Nerc6KCaD9Dzx8hM8V54i/hLdUibeObeord5I0AYhDMTHnCfAmTHNxwhPPD7V+JXzN0NhAd8MKLd7XW36X9BGIQ/R3ggVMo+1R+WCBHmQLu66/U9+iPE/b6+z+9oWQ2hD22oYxydtIoYhEE4I+Ge7Fcl4YEucEOE2a5ZZyh59oNy1y87dMfshU6W8AmLMYz0kTUQBuFshIcKoKps+c6XIjwg5gHmvhxMMw6y6eE1XVDIR0jGw+AAM3/lLiHttIAwCGci3GG4zH2uLjc8EOcEs58GYSlyaOyUKdT6p6wruv4DfML88F6H3wPC1qROhLud8EFmxtDryYEwL3R+maA5MA8Td1TdINHq4V9/x88nTGQRMUw5SaKGhEfj6JoJnSY87oryP8d0BsIZCPsJDwqrkjiobuVZ7p45MqaO5nVVET3Ur6OUS8L8CMfQ43o7+9cLxwjP6CjpcXQ0U4SvRumvCsJbEG7rDtM8FNcVVUfQk+qaosPXdUMbpAn3iPxdYD97g7SLkmpNeCw72Ct6lfCwuVw7YYSntJyuuP6EjZ42LLirOlq9ine/XviBhATFc1/14l3/4XtCeE6NTBsjOhGraTSirBiLOkIQZuwTSw0QzkzYTJ/45W4gmOmM9a5ynDhUOAzSj2/UmPCIzhXSJMJT5XsSAg3COxPeIp0tLuLMnloRlpGFxIwqwaxKkOtnoXpirPrdq1L63/0mXGzqSviKapr+QojwXK+eh8sLEAbh6giPaULY2nkjgTAnOw8/dJ7pXUG46tSe8OQqdseIV8BsB25aWvcLwiC8UzhNc5AsTnhOx7oGntFxtncBYUtSP8LzWE0wHimsfiExoTN/N25U0nENEAbhrTLyAQeH3OKEZ/NgJKLEI8wgDMIpESPAM8nVqHHjhBvGYNpVCftxIAzC24SrZSXuTPqlwbGKzYT1MQ4QBuGqCXO9fDyY6r6YlxJTmpSZeUiDlnFgDoRBeGvH1D8vjR873oLwRFYSI4wLg7AdhIOds8iO2ppCQh2BLmNwDYRBeCfC00iFsI4woz72z70EYRCumHDooHF4P20t4QavPcY4RwKErSBsHoqLVAbrCc/CIxggDMJVEl6f9YTFEZESzpQAYRB2PI4RdiUgDML1+RBAuOgGBuGiWzi2AML5NjAIF93CsQUQzreBQbjoFo4tgHC+DQzCRbdwbAGE821gEC66hWMLIJxvA4Nw0S0cWwDhfBsYhItu4dgCCOfbwCBcdAvHFkA43wYG4aJbOLYAwvk2MAgX3cKxBRDOt4FrRlidNzWn08YkOIdqTks49XpdC8cWQDjfBq4X4bk6IXtO542ZnN92pE5zna07abvoFo4tgHC+DVwvwnou8mkwjcFEXboIwjVNvQjP6awxllM1m1rHkrCWC8K1Sr0Is4p3Fr4wXPTKIAzCjhDms3RMRgqxsf8GwiDsBuEZv1RcFsHBFV26Vx6hFq5p6kR4ZFxg6zO1iLAREM6xgWtEOJiC0R9KE5fQTqkdhUTpbkHYNcIsV5NgDjv/ux4mtLz5mhNaONemBuF4A9eK8JTPvDGPVgusipjMgn6ZlnuoDoSLbuBaEWZ97lzOvmHMAiZJg3BdUyvCdOxPQz4XIxMT3hWPRuPRXNUSk9JmvQ1aONemBuF4A9eI8NyYw0vsvIm9uzm9Go8ac/EF7SBcw9SJ8MycwWs0msiCgX/RH++CzdkZS23hXJsahOMNXCPCIhM1MnwlSooZ5RUFCIOwI4Rn/mkRUzUkMaV8mG3sD6qhkKhf6kTY35mTh+N4GSEHJqolXN0hORB2jbD0OtelwohSNRDBCYe/b7W0LwiuuPMFYbcIq0w00Lk+3gzCIOwU4XjGlR5grlovCNeAsPstDMIFNzAIF93CIFxwA4Nw0S0MwgU3cDmEXU3Vet1uvZIauBTCCFJcQBhxPCCMOB4QRhwPCCOOB4QRxwPCiOMBYcTxgDDieEAYcTwgjDgeEEYcDwgjjgeEEccDwojjAWHE8YAw4nhAGHE8IIw4HhBGHA8I256qr9DE5Z/IJ1Pja/Aduggf+URAOK2BQNjygHBaA4Gw5QHhtAYCYcsDwmkNBMKWB4TTGgiELQ8IpzUQCFseEE5rIBC2PCCc1kAgbHlAOK2BQNjygHBaA5VB2JYD77ZsBwi7R9iSdrFlO0A4zyYCYbs/HxAGYRu3A4TzbCIQtvvzAWEQznE7rslN6Z8PCIPwrttx/YOQ2x93iXeRRemfDwiD8I7bca/+MtcJ94Fw3gHhXdslfTtuyO3dQ+Ph7hGEywgI79ouqdvxcEv+Xn8vCOcdEN61XVK3447cBzceFktCHmVVfLcktwtJeHV/S5bbWAbhcpoIhM0sSLAf9/Ao/1r3Yj3PLSf8962/tozPB4RBeKfteDJ24xaEF8R3vLRg9cUNK5AF4SeyeGisHjcVHHl+PiAMwpkJP5IV/7Fgbq9lp/sPW3yQi9uUxSBcThOBsJl78o+/TB7FD451IcFeC80q/yvn8wFhEN5pO26MGjeFsGu98JyW+iFsFxDetV1St2NFghp3qQuJG1ZB+IXEapsduRw/n9wab0QnyXdc0VmRn0bxTQTCodyrQxtP12zx8W+xD7diBTDfnbsRu3NLcsMe8E/isY8CPp/8Go/SaXBjFCyDcL0I65E0tlv3IEfPxDDb/8TSIyesKwnnRiSuDMJzGvTJBuERjWZc1UcFwtm34+ZRn+bzcM8Q/5C97WJJljd/izPV/v5xyx6Q3gnbQXhME8LWT6iujUG4boQt+3yKIty4mqhOOUS41AYC4d3bxZbtKJGwzGiUtHYedc0Jj/1yYz7Z+vUrbSIQtvvzyWej6daEZ5ReyXunof0/i5sIhO3+fIohPL4KlqOFxFgVwLSEkQoQ3rVdbNmO8gmHd8umlAZVb6wWngjwJfTBILx7u9iyHWUTnpkFgwB7Relc3RnfnWN3zkb+/dY3EQjb/fnkstHTGOHGdKThJoxIMMP0atc3qayJrCG88E8SuyNFtcu+Ep4HBzLG1FgbHWrzB9VGZRTCeTVRdYQX8hyE4KYmfE9i1w8vn2JPJ8vd2yVHwkRvUcLW5vn55LLRV0GfOtqGsDjEUUIpXFvCjWVMZ5zw3fpTxcog7G/8htN+7CE8DjzqEeKZ7mbHRtGrCPMq4gq7c2s/haeEZz41FOGludbo3UzC90nvfbdVu+RH2H9ff2viv1HWEJ4ZZYEeXtMd89w8gU0Qnso9PWOHr7iAcGWEA7j+FlhM+MoYU9OLqsOdidtXk2DlRHe/ZRh2k7Afs5BY+ZQX92qF+LGMvseT/+S7DO2yu4bb26S1/ELnp6XcwFVjXSlhDWHD4kwR1j9lXaFH0BhhGvTYJRh2lfB15Hkrk/C9BKEuc19LmJAs7ZKoYcMMVGve55pvxjWv2K+Xd43rddfR2UJ4Yhybm6q64UrqnFD9EOF2RGdT4zjeBL3w9oQbwe7cHb+tqeodO31b/1yQxcJ8iS3bJUnDphmo1hBe+t3uxks4LCE8NzvTuSqB9XE4tXpMR8HaEuMuYbPXujcIh+vkpU/Y3+1XhFfsvpwIb5yBal1vfxf/y6/ij7KD8DR00q/iPBXrQqcHXzWSzhcueHjYXcLreuF1hO905asIL81K+I5E6uJdCG+egaoGhJlgWRqoE4fljYmQHB4YnoLwpwkv9PWWwUMV4SUJFRQLQ8xdUB+nt0tcQ2gGqjv2K6SmmuJzUfErMwh5YJXGk2DOJ6i6vX8wn259ITHzT+iZGIJ50Rt94KiMQxmFNJEthYQoSfk/5ivyFHSqkrB/nyR8Z3R6i4RuchfC5sjGjfxrLPQ78jfjs1Cx3D74l9U9PhhPt55wY1rwpUOfi7uEY70wV8k4hNc/KcJPnKmsFsRQALvHILzaoV3iGszpe26e/uEX2vOBBnJ7zTrdH4LwXWMlCpcF+bFqsD75Jj5OIre+kM8HU6E4Qvia3PFaOInwQvW5TxyJWMdHI1aR11hs1S6bCcs8En7Bsp7UR16pLI5mP8pihm0CCOcVdwmvG5FocFPi1pMuggnRdfCC4RG9MJ9dJy/C5gxUjX9+iKqBb8SDWiXrFLHF+q0eIy9xve4oCwinxl3CsV64oQmr2lQrXy5XQaXAVqpdt0VuhYQ5A5UepkshHN17BOHsqSFh3rlyU7rnjZ6zljthcwaq21veI/N/Bu6NQkJu8cLcllXS376gzweE7SS8oZBQY67qzsIJmzNQkVu2u7a4JXwblmx37uZHiPA9uedV+48FCOeWehKWBbD65z1CWB+ly5GwMQOVHEnjhBtq/CxEWE9Qpb577l4XFCgkssdJwok9GHfo787xfTOiduIMwhKYOvDgw73/LGFjBio+AdXyZsHPTeOLYtIpeaaa/KV7uGe/XP6g9ZPeGBDOnhoRFuXxamEolQsG4TtCjMEJDlei3qVd8tVwT9SGgXDWOEl4TaRYc3DsesPplJKwEJ/Ap7zLP9Xv45opAkE4NXUiXE675L4dxj8bBX0+IAzCNm4HCOfZRCBs9+cDwiBs43bkQ/g/LgaEQdh4/X/dCwiDMAiDsJE7YzjMOEChLxtJOPKX08RYIAzChRJeLvUh7y0IZ5oYC4RBOAfCSZMCPUnMCmUK4U/MKgTCIFwkYX5VkzjjHoRB2GrCjTWFhDgbzid8L13nPDEWCINwgYTFuW+csD4h6b6R+8RYIAzCeRE2c6coc5R6TpaGus4+54mxQBiEiyPM+lvV565kLWwSzmtiLBAG4bwIxwoJDpL1wctgd84knNfEWCAMwkURZt2qmAUgGJFYiSG2nCfGAmEQzotwtJBYkOsNhHObGKs6whSEa064sWhECMvaIeeJsYom/Pyy5o6f9OdmYi/0VS68UuPmC33b8FsRvBl9BuGyCScMqpmEr3W3m/PEWAUTfqf0nUM25liVMN+44NdgbVycT/jlgz9W3vyg+nfiOTRx609pPfi1AGHrCK+WREwekffEWAUTZpZoEuEX+vFvlHCIuEGYPe7jRd58DvrZ5w/jTT5+atcf7JfjDYTLJpz4V1g1ooWEPOCc88RYhRN+ScL0IjvnKPYEwu/xqbJlKZHQC7P8/PkOwjYTNmabD55sOeF/X59jWpnghBJZqHuJEX6NPfltbS/MExDW2kG4cMLrEhCWWfnzHLtEOJ53IfhnlJcm/GFWHesJx3th+XshCL+aHTYIl0RYHW4zphmWhIPb95EpWSTrz02MVQXhf19fRE+8LeFwFbF2TELtzb0F1fULCJdG+FrXDmrpKSAcOmq8yn1irGIJi0r25SVcysoqlVXDoY70I7mQEA8NygSFkiaFj1fQF/UW4sXe6LohPRDOl7DmyemttExdC5snA4sRiXwnxqqK8AezGCW8bkQiTnhdfr6+qOoBhEslvEiY65r3rU9k+3fKOjFWsYQNRj9DRe2zMWLw7vfLivDrc4RwbDgi1hE/m28IwqUTrnI7yiIsnL7rUYRnmkRYFxLPAm+kF35RK33Cz8arPycTfgVhEM6N8E8+EPyqSoIPupEwM/weOrQR7pS374WfE0afa0C43Fi/HSURVgBfBa83+vG+kfC7HE7YTDipF359DQi/iQK7hoSRTyQ74Q9lTPaLz/9uJiyqYW32g0bytr4X/mBvpgmLHbsNe38gvI/JTFiUEW9q5MFku4aw2e0q/fqmroaTeuF3/urmAeb3DceZQXgfk5VwMHr2qsrh900jElsRNvv44NbPMOGX2LE9EN7vZCVsSnoOBigyEVZCY5G7by/6ATKvKCSQUDIQfk3epzIJv6lxikghoSmahCODD9FeWByzfjGOhHxsGJIA4X3M7oRf+S5VwvUZmvCH0fGaIxIioUFdsyd/oUlRvwuh0zM3DEmA8D4mywHm0Int+mQGn/BzsjPxsDD8TWWtyrPst1/CbwXCSJDde+Gf70Ff6+/SpVHMmrdNRzJAGPk/XISf3kAgbHlAOK2BQNjygHBaA4Gw5QHhtAYCYcsDwmkNBMKWB4TTGgiELQ8IpzUQCFseEE5rIBC2PCCc1kAgbHlAOK2BQNjygHBaA4Gw5QHhtAYCYcsDwmkNBMKWB4TTGgiELQ8IpzUQCFseEE5rIBC2POsJuxgQ3sOUO4tWuQHhvQgIpzUQCFseEE5rIBC2PCCc1kAgbHlAOK2BQNjygHBaA4Gw5QHhtAYCYcsDwmkNBMKWB4TTGgiELQ8IpzUQCFseEE5rIBC2PCCc1kAgbHlAOK2BQNjyVH1uWaHJpYFAGHE7IIw4HhBGHA8II44HhBHHA8KI4wFhxPGAMOJ4QBhxPCCMOB4QRhwPCCOOB4QRxwPCiOMBYcTxgDDieEAYcTwgjDiePAkjSBXJjzCCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCIAiCVJv/B9PaYqmLdKi6AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA5LTI3VDAxOjI2OjA2KzAwOjAwKVYb5AAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wOS0yN1QwMToyNjowNiswMDowMFgLo1gAAAAodEVYdGRhdGU6dGltZXN0YW1wADIwMjMtMDktMjdUMDE6MjY6MDYrMDA6MDAPHoKHAAAAAElFTkSuQmCC" alt=""/></p><p>这张图反映了实际中Java进程内存占用，与规范中定义的JVM运行时数据区之间的差别，它可以看作是运行时数据区的一个超集。毕竟理论上的视角和现实中的视角是有区别的，规范侧重的是通用的、无差别的部分，而对于应用开发者来说，只要是Java进程在运行时会占用，都会影响到我们的工程实践。</p><p>我这里简要介绍两点区别：</p><ul><li><p>直接内存（Direct Memory）区域，它就是我在<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/article/8393">专栏第12讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中谈到的Direct Buffer所直接分配的内存，也是个容易出现问题的地方。尽管，在JVM工程师的眼中，并不认为它是JVM内部内存的一部分，也并未体现JVM内存模型中。</p></li><li><p>JVM本身是个本地程序，还需要其他的内存去完成各种基本任务，比如，JIT Compiler在运行时对热点方法进行编译，就会将编译后的方法储存在Code Cache里面；GC等功能需要运行在本地线程之中，类似部分都需要占用内存空间。这些是实现JVM JIT等功能的需要，但规范中并不涉及。</p></li></ul><p>如果深入到JVM的实现细节，你会发现一些结论似乎有些模棱两可，比如：</p><ul><li>Java对象是不是都创建在堆上的呢？</li></ul><p>我注意到有一些观点，认为通过<a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Escape_analysis">逃逸分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，JVM会在栈上分配那些不会逃逸的对象，这在理论上是可行的，但是取决于JVM设计者的选择。据我所知，Oracle Hotspot JVM中并未这么做，这一点在逃逸分析相关的<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/performance-enhancements-7.html#escapeAnalysis">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>里已经说明，所以可以明确所有的对象实例都是创建在堆上。</p><ul><li>目前很多书籍还是基于JDK 7以前的版本，JDK已经发生了很大变化，Intern字符串的缓存和静态变量曾经都被分配在永久代上，而永久代已经被元数据区取代。但是，Intern字符串缓存和静态变量并不是被转移到元数据区，而是直接在堆上分配，所以这一点同样符合前面一点的结论：对象实例都是分配在堆上。</li></ul><p>接下来，我们来看看什么是OOM问题，它可能在哪些内存区域发生？</p><p>首先，OOM如果通俗点儿说，就是JVM内存不够用了，javadoc中对<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/9/docs/api/java/lang/OutOfMemoryError.html">OutOfMemoryError<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的解释是，没有空闲内存，并且垃圾收集器也无法提供更多内存。</p><p>这里面隐含着一层意思是，在抛出OutOfMemoryError之前，通常垃圾收集器会被触发，尽其所能去清理出空间，例如：</p><ul><li><p>我在<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/article/6970">专栏第4讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的引用机制分析中，已经提到了JVM会去尝试回收软引用指向的对象等。</p><ul><li>在<a target="_blank" rel="noopener noreferrer" href="http://hg.openjdk.java.net/jdk/jdk/file/9f62267e79df/src/java.base/share/classes/java/nio/Bits.java">java.nio.BIts.reserveMemory()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法中，我们能清楚的看到，System.gc()会被调用，以清理空间，这也是为什么在大量使用NIO的Direct Buffer之类时，通常建议不要加下面的参数，毕竟是个最后的尝试，有可能避免一定的内存不足问题。</li></ul></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">-XX:+DisableExplicitGC</span></div></pre></div><p>当然，也不是在任何情况下垃圾收集器都会被触发的，比如，我们去分配一个超大对象，类似一个超大数组超过堆的最大值，JVM可以判断出垃圾收集并不能解决这个问题，所以直接抛出OutOfMemoryError。</p><p>从我前面分析的数据区的角度，除了程序计数器，其他区域都有可能会因为可能的空间不足发生OutOfMemoryError，简单总结如下：</p><ul><li><p>堆内存不足是最常见的OOM原因之一，抛出的错误信息是“java.lang.OutOfMemoryError:Java heap space”，原因可能千奇百怪，例如，可能存在内存泄漏问题；也很有可能就是堆的大小不合理，比如我们要处理比较可观的数据量，但是没有显式指定JVM堆大小或者指定数值偏小；或者出现JVM处理引用不及时，导致堆积起来，内存无法释放等。</p></li><li><p>而对于Java虚拟机栈和本地方法栈，这里要稍微复杂一点。如果我们写一段程序不断的进行递归调用，而且没有退出条件，就会导致不断地进行压栈。类似这种情况，JVM实际会抛出StackOverFlowError；当然，如果JVM试图去扩展栈空间的的时候失败，则会抛出OutOfMemoryError。</p></li><li><p>对于老版本的Oracle JDK，因为永久代的大小是有限的，并且JVM对永久代垃圾回收（如，常量池回收、卸载不再需要的类型）非常不积极，所以当我们不断添加新类型的时候，永久代出现OutOfMemoryError也非常多见，尤其是在运行时存在大量动态类型生成的场合；类似Intern字符串缓存占用太多空间，也会导致OOM问题。对应的异常信息，会标记出来和永久代相关：“java.lang.OutOfMemoryError: PermGen space”。</p></li><li><p>随着元数据区的引入，方法区内存已经不再那么窘迫，所以相应的OOM有所改观，出现OOM，异常信息则变成了：“java.lang.OutOfMemoryError: Metaspace”。</p></li><li><p>直接内存不足，也会导致OOM，这个已经<a target="_blank" rel="noopener noreferrer" href="http://time.geekbang.org/column/article/8369">专栏第11讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>介绍过。</p></li></ul><p>今天是JVM内存部分的第一讲，算是我们先进行了热身准备，我介绍了主要的内存区域，以及在不同版本Hotspot JVM内部的变化，并且分析了各区域是否可能产生OutOfMemoryError，以及OOME发生的典型情况。</p><h2 id="一课一练"><a aria-hidden="true" tabindex="-1" href="/blog-test/java核心技术面试精讲/03.模块二java进阶/11#一课一练"><span class="icon icon-link"></span></a>一课一练</h2><p>关于今天我们讨论的题目你做到心中有数了吗？今天的思考题是，我在试图分配一个100M bytes大数组的时候发生了OOME，但是GC日志显示，明明堆上还有远不止100M的空间，你觉得可能问题的原因是什么？想要弄清楚这个问题，还需要什么信息呢？</p><p>请你在留言区写写你对这个问题的思考，我会选出经过认真思考的留言，送给你一份学习奖励礼券，欢迎你与我一起讨论。</p><p>你的朋友是不是也在准备面试呢？你可以“请朋友读”，把今天的题目分享给好友，或许你能帮到他。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/java核心技术面试精讲/03.模块二Java进阶/11.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/27 09:43:57</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-test/umi.3ded5539.js"></script>
  </body>
</html>
